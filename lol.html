<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris with Controller</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        canvas { background: black; display: block; margin: auto; }
        #status { margin-top: 10px; font-size: 18px; }
    </style>
</head>
<body>
    <h1>Tetris (Controller Supported)</h1>
    <p id="status">No controller detected</p>
    <canvas id="tetris" width="300" height="600"></canvas>
    <script>
        const canvas = document.getElementById("tetris");
        const ctx = canvas.getContext("2d");
        const statusText = document.getElementById("status");
        const ROWS = 20, COLS = 10, SIZE = 30;
        const board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
        const colors = ["black", "red", "blue", "green", "yellow", "purple", "orange", "cyan"];
        let gamepadIndex = null;
        
        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            board.forEach((row, y) => row.forEach((val, x) => {
                ctx.fillStyle = colors[val];
                ctx.fillRect(x * SIZE, y * SIZE, SIZE, SIZE);
                ctx.strokeRect(x * SIZE, y * SIZE, SIZE, SIZE);
            }));
        }
        
        function checkGamepad() {
            const gamepads = navigator.getGamepads();
            if (gamepads[gamepadIndex]) {
                statusText.textContent = "Controller connected: " + gamepads[gamepadIndex].id;
            } else {
                statusText.textContent = "No controller detected";
                gamepadIndex = null;
            }
        }
        
        function updateGamepad() {
            if (gamepadIndex !== null) {
                const gamepads = navigator.getGamepads();
                if (gamepads[gamepadIndex]) {
                    const gp = gamepads[gamepadIndex];
                    if (gp.buttons[14].pressed) move(-1);
                    if (gp.buttons[15].pressed) move(1);
                    if (gp.buttons[0].pressed) rotate();
                    if (gp.buttons[13].pressed) drop();
                }
            }
            requestAnimationFrame(updateGamepad);
        }
        
        function move(dir) {
            console.log("Move:", dir);
        }
        
        function rotate() {
            console.log("Rotate");
        }
        
        function drop() {
            console.log("Drop");
        }
        
        window.addEventListener("gamepadconnected", (e) => {
            gamepadIndex = e.gamepad.index;
            statusText.textContent = "Controller connected: " + e.gamepad.id;
            console.log("Gamepad connected:", e.gamepad.id);
            requestAnimationFrame(updateGamepad);
        });
        
        window.addEventListener("gamepaddisconnected", () => {
            statusText.textContent = "No controller detected";
            gamepadIndex = null;
        });
        
        setInterval(checkGamepad, 1000);
        drawBoard();
    </script>
</body>
</html>
